<!--
If not stated otherwise in this file or this component's Licenses.txt file the
following copyright and licenses apply:
Copyright 2024 RDK Management
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at
http://www.apache.org/licenses/LICENSE-2.0
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<div class="container-fluid bg-container">
    <div class="row ">
        <div class="col-md-2 col-sidebar">
            <div class="sidebar">
                <div class="execution-drop">
                    <button type="button" class="download-btn  execution-select" (click)="openDialog('normalExecutionClick')" >
                        {{executeName}}
                    </button>
                </div>
                <div class="accordion accor-margin" id="accordionExample">
                    <div class="row accord-row">
                      <div class="accordion-item device-section" *ngFor="let parent of filteredDeviceStausArray">
                          <h2 class="accordion-header d-flex align-items-center accord-head">
                            <div class="col">
                              <i class="bi bi-folder-fill folder-icon"></i><span> {{ parent.name }} </span>
                              <div class="row-arrows">
                                <button type="button" class="refresh-btn" matTooltip="Refresh" (click)="refreshDevice()">
                                  <i class="bi bi-arrow-clockwise refresh-icon" ></i>
                              </button>
                                <button class="btn btn-link ms-auto" (click)="togglePanel(parent)">
                                    <i class="bi collapse-icon" [ngClass]="parent.isOpen ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
                                </button>
                              </div>
                            </div>
                          </h2>
                        <div [class.show]="parent.isOpen" class="accordion-collapse collapse show">
                          <div class="col-md-12 mb-2">
                            <input type="text" #searchInput class="form-control seach-device" [(ngModel)]="searchTerm" (input)="searchDevices($event)"
                            placeholder="Search device">
                            <button class="clear-btn mt-1" *ngIf="searchTerm" (click)="clearSearch()">Clear</button>
                            <span class="sort-label">Sort :</span>
                            <button (click)="toggleSortOrder()" class="sort-btn">
                              <!-- Sort {{ sortOrder === 'asc' ? 'Ascending' : 'Descending' }} -->
                              <i class="bi sort-icon icon-sortng" [ngClass]="sortOrder === 'asc' ? 'bi-sort-up-alt' : 'bi-sort-down-alt'  "></i>
                            </button>
                          </div>
                          <div *ngIf="filteredDeviceStausArray.length === 0" class="no-results">
                            No matching devices found.
                          </div>
                            <div class="accordion-body status-group">
                                <ul class="ul-item">
                                    <li class="li-item" *ngFor="let child of parent.childData" >
                                      <span *ngIf="child.status === 'BUSY'">
                                        <div class="spinner-border spinner-border-sm text-warning spinner" role="status">
                                          <span class="visually-hidden">Loading...</span>
                                        </div>
                                      </span>
                                      <span *ngIf="child.status === 'FREE'"><span class="free"></span></span>
                                      <span *ngIf="child.status === 'NOT_FOUND'"><span class="busy"></span></span>
                                      <span *ngIf="child.status === 'HANG'"><span class="hang"></span></span>

                                        <a class="device-name" [matTooltip]="'Name: ' + child.deviceName + '\nIP: ' + child.ip + '\nDeviceType: ' + child.deviceType + '\nStatus: ' + child.status"
                                        matTooltipClass="multiline-tooltip" [matTooltipPosition]="'right'" (click)="openModalExecute(child)"
                                           >
                                            {{child.deviceName}}
                                        </a>

                                        <!-- <span *ngIf="child.thunderEnabled === true"><i class="bi bi-lightning-charge-fill thunder-icon"></i></span> -->
                                        <button mat-icon-button [matMenuTriggerFor]="menu" class="context-btn">
                                            <mat-icon class="dot-icon">more_vert</mat-icon>
                                        </button>
                                          <mat-menu #menu="matMenu" class="mat-contxtmenu">
                                            <button mat-menu-item class="context-item" *ngIf="child.thunderEnabled === false" (click)="enableDisable(child.ip)">
                                              <span>Enable Thunder</span>
                                            </button>
                                            <button mat-menu-item class="context-item" *ngIf="child.thunderEnabled === true" (click)="enableDisable(child.ip)">
                                              <span>Disable Thunder</span>
                                            </button>
                                            <button mat-menu-item class="context-item" (click)="copyToClipboard(child.ip)">
                                              <span>Copy Device IP</span>
                                            </button>
                                            <button mat-menu-item class="context-item">
                                                <span>Install TDK</span>
                                              </button>
                                          </mat-menu>
                                    </li>
                                
                                </ul>
                            </div>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-10">
            <div class="radiobox borders-btm">
                <h3 class="heading ">Select the RDK flavor :</h3>
                <div class="rdkgroup">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input rdkradio" type="radio" name="rdkradio" id="rdkv" value="RDKV" [(ngModel)]="selectedDfaultCategory" (change)="onCategoryChange('RDKV')">
                        <label class="form-check-label" for="rdkv">Video</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input rdkradio" type="radio" name="rdkradio" id="rdkb" value="RDKB" [(ngModel)]="selectedDfaultCategory" (change)="onCategoryChange('RDKB')">
                        <label class="form-check-label" for="rdkb">Broadband</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input rdkradio" type="radio" name="rdkradio" id="rdkc" value="RDKC" [(ngModel)]="selectedDfaultCategory" (change)="onCategoryChange('RDKC')">
                        <label class="form-check-label" for="rdkc">Camera</label>
                    </div>
                </div>
            </div>
            <div class="col-md-12 example-header" *ngIf="tabName !=='Execution Schedules'">
              <div class="filterby">
                <label for="filterDropdown" class="filter-label">Filter By:</label>
                <div class="filter-drop-down">
                  <select id="filterDropdown" class="form-select" (change)="onFilterChange($event)">
                    <option value="" default>Select</option>
                    <option value="ExecutionName">Execution Name</option>
                    <option value="Scripts/Testsuite">Scripts/Testsuite</option>
                    <option value="Device">Device</option>
                    <option value="User">User</option>
                  </select>
                </div>
              </div>
              <div class="search-bar" *ngIf="selectedCategory === 'Device' || selectedCategory === 'Scripts/Testsuite' || selectedCategory === 'ExecutionName'">
                <!-- <label class="search">Enter {{ selectedCategory }}</label> -->
                <label *ngIf="selectedCategory === 'ExecutionName'" class="search">Enter Execution Name</label>
                <label *ngIf="selectedCategory === 'Scripts/Testsuite'" class="search">Enter Scripts/Testsuite</label>
                <label *ngIf="selectedCategory === 'Device'" class="device-search">Enter Device Name</label>
                <div class="searchby">
                  <input type="text" class="form-control seach-input" id="filter-text-box" [(ngModel)]="searchValue"
                    placeholder="">
                    <button class="btn btn-sm search-btn" (click)="onSearchClick()"><i class="bi bi-search icon-search"></i></button>
                </div>
              </div>

      
              <div class="search-user" *ngIf="selectedCategory === 'User'">
                <div class="userby">
                  <label for="dynamicDropdown" class="userbylabel">Select User Name</label>
                  <div class="user-drop-down">
                    <select id="dynamicDropdown" class="form-select user-dropdown" [(ngModel)]="selectedOption" (change)="onUserChange()">
                      <option value="" default>Select</option>
                      <option *ngFor="let item of dynamicList" [value]="item">{{ item }}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="container table-container mt-3">
                <!-- TABS CONTAINER -->
                <mat-tab-group animationDuration="0ms" mat-align-tabs="start" (selectedTabChange)="onTabClick($event)">
                    <mat-tab label="Execution History" class="tab-label">
                        <div style="width: 100%; height: 390px;" [class]="themeClass">
                            <ag-grid-angular
                            style="width: 100%; height: 100%;"
                            [rowData]="rowData"
                            [columnDefs]="columnDefs"
                            [defaultColDef]="defaultColDef"
                            [pagination]="false"
                            [rowHeight]="40"
                            rowSelection="multiple"
                            (gridReady)="onGridReady($event)"
                          ></ag-grid-angular>
                        </div>
                        <div class="table-footer">
                          <div class="col-md-3">
                            <div class="header-container">
                              <div class="btn-border">
                                <button class="btn btn-sm delete-btn" (click)="deleteSelectedRows()">
                                  <i class="bi bi-trash-fill delete-icon"></i>
                                </button>
                                <button class="btn btn-sm arrow-btn" (click)="deleteDateModal()" matTooltip="Delete execution with date">
                                  <i class="bi bi-caret-down-fill arrow-icon"></i>
                                </button>
                              </div>
                    
                            </div>
                            <!-- <a class="delete-date" (click)="deleteDateModal()">Delete execution with date</a> -->
                          </div>
                          <div class="col-md-9">
                            <mat-paginator
                            class="pagination-sec"
                            [length]="totalItems"
                            [pageSize]="pageSize"
                            [pageSizeOptions]="[5, 10, 20]"
                            (page)="onPageChange($event)"
                            [showFirstLastButtons]="true"
                          ></mat-paginator>
                          </div>
                        </div>
                    </mat-tab>
                    <mat-tab label="Execution Schedules" class="tab-label">
                        <div style="width: 100%; height: 412px;" [class]="themeClass">
                            <ag-grid-angular
                                style="width: 100%; height: 412px;"
                                [columnDefs]="columnSchudle"
                                [defaultColDef]="{sortable: true}"
                                [rowData]="rowDataSchudle"
                                [pagination]="true"
                                [paginationPageSize]="schedulePageSize"
                                [paginationPageSizeSelector]="schedulePageSizeSelector"
                                [animateRows]="true"
                                [context]="this"
                                [gridOptions]="gridOptions"
                            ></ag-grid-angular>
                        </div>
                    </mat-tab>
                  </mat-tab-group>
        </div>
    </div>
</div>